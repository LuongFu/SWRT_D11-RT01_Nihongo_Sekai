@using JapaneseLearningPlatform.Data.ViewModels
@model List<CourseWithPurchaseVM>

@{
    ViewData["Title"] = "Home";
}

@section Head {
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nihongo Sekai - Japanese Learning Platform</title>
    <meta name="description"
          content="Master Japanese through immersive conversations, cultural insights, and personalized learning paths with native speakers." />
}

@section Styles {
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
          rel="stylesheet" />
    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="~/css/styles.css" asp-append-version="true" />
    <style>
        /* ==================== SECTION HEADER — XẾP DỌC, CĂN GIỮA ==================== */
        .section-header {
            display: flex !important;
            flex-direction: column; /* Ép xếp dọc */
            align-items: center; /* Căn giữa theo trục ngang */
            text-align: center; /* Căn chữ giữa */
            gap: var(--spacing-md); /* Khoảng cách giữa các dòng */
            margin-bottom: var(--spacing-2xl);
        }

            /* Reset margin mặc định */
            .section-header h2,
            .section-header p,
            .section-header .btn {
                margin: 0;
            }

            /* Nếu có nút .btn trong header, đẩy xuống xa hơn */
            .section-header .btn {
                margin-top: var(--spacing-lg);
            }


        /* Ở mobile: ép xuống hàng, căn giữa */
        @@media (max-width: 768px) {
            .section-header

        {
            flex-direction: column !important;
            text-align: center;
        }

        .section-header h2 {
            font-size: 1.75rem;
        }

        .section-header p {
            font-size: 1rem;
        }

        .section-header .btn {
            margin-top: var(--spacing-md);
        }

        }
        /* Why Choose Section */
        .why-choose {
            padding: var(--spacing-3xl) 0;
            background: var(--color-gray-50);
        }

        .learn-more-btn {
            color: #fafafa;
            transition: color var(--transition-base);
        }

            .learn-more-btn:hover {
                color: #ffffff;
            }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
        }

        .feature-card {
            background: var(--color-white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--color-gray-200);
            transition: all var(--transition-base);
        }

            .feature-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-lg);
            }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-lg);
            display: block;
        }

        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-md);
            color: var(--color-gray-900);
        }

        .feature-card p {
            color: var(--color-gray-600);
            line-height: 1.6;
            margin: 0;
        }

        /* Testimonials Section */
        .testimonials {
            padding: var(--spacing-3xl) 0;
            background: var(--color-white);
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
        }

        .testimonial-card {
            background: var(--color-white);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-gray-200);
            transition: all var(--transition-base);
        }

            .testimonial-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }

        .testimonial-content {
            margin-bottom: var(--spacing-xl);
        }

            .testimonial-content p {
                font-style: italic;
                font-size: 1.125rem;
                line-height: 1.6;
                color: var(--color-gray-700);
                margin: 0;
            }

        .testimonial-author {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .author-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

            .author-avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .author-info h4 {
            font-size: 1.125rem;
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--color-gray-900);
        }

        .author-info p {
            font-size: 0.875rem;
            color: var(--color-gray-600);
            margin: 0 0 var(--spacing-sm) 0;
        }

        .author-rating {
            color: var(--color-accent-600);
            font-size: 0.875rem;
        }

    </style>
}

<!--Header Advertisement-->
@if (!User.Identity.IsAuthenticated || !User.IsInRole("Learner"))
{
    <section class="hero animate-on-scroll">
        <div class="container hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    Master Japanese with <span class="highlight-yellow">Native Speakers</span>
                </h1>
                <p class="hero-subtitle">
                    Join our immersive learning community and discover the beauty of Japanese language and culture through personalized courses and live conversations.
                </p>
                <div class="hero-buttons">
                    <a href="/Courses" class="btn btn-primary btn-large">
                        <i class="bi bi-play-circle me-1"></i> Start Learning Today
                    </a>
                    <a href="~/About" class="btn btn-outline btn-large">Learn More</a>
                </div>
                <div class="hero-stats">
                    <div class="stat-item"><strong>10,000+</strong> <span class="stat-label">Students</span></div>
                    <div class="stat-item"><strong>150+</strong> <span class="stat-label">Courses</span></div>
                    <div class="stat-item"><strong>50+</strong> <span class="stat-label">Partners</span></div>
                    <div class="stat-item"><strong>95%</strong> <span class="stat-label">Success Rate</span></div>
                </div>
            </div>
            <div class="hero-image-wrapper float-animation shadow-lg">
                <img src="https://images.unsplash.com/photo-1528360983277-13d401cdc186?w=600&h=400&fit=crop" alt="Banner" />
                <div class="kanji-overlay">日</div>
            </div>
        </div>
    </section>
}
<section class="section bg-light py-5 animate-on-scroll">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4 px-3 py-2 bg-white rounded shadow-sm">
            <h2 class="fw-bold m-0">Featured Courses</h2>
            <p class="text-muted m-0">Start your Japanese journey with our most popular courses</p>
        </div>

        <div class="row g-4">
            @foreach (var item in Model)
            {
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm border-0">
                        <img src="@item.Course.ImageURL" class="card-img-top" alt="@item.Course.Name" style="height: 200px; object-fit: cover;" />
                        <div class="card-body">
                            <h5 class="card-title">@item.Course.Name</h5>
                            <p class="card-text">@item.Course.Description</p>
                            <p class="text-muted">@item.Course.CourseCategory - <strong>@item.Course.FinalPrice.ToString("C")</strong></p>
                            <a asp-controller="Courses" asp-action="Details" asp-route-id="@item.Course.Id" class="btn btn-danger w-100 mt-2">
                                View Course
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="text-center mt-4">
            <a asp-controller="Courses" asp-action="Index" class="btn btn-danger">
                View All Courses <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
</section>

<!-- Why Choose Nihongo Sekai -->
<section class="why-choose animate-on-scroll" id="features">
    <div class="container">
        <div class="section-header">
            <h2>
                Why Nihongo Sekai Is Your Ultimate Japanese Learning Partner
            </h2>
            <p>
                Interactive courses, live native-speaker sessions, and
                personalized paths—all in one place.
            </p>
            <a href="about.html" class="btn btn-primary learn-more-btn">Learn More</a>
        </div>

        <div class="features-grid">
            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">💬</div>
                <h3>Live Conversations</h3>
                <p>
                    Practice with native speakers in real-time video sessions
                    tailored to your level.
                </p>
            </div>

            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">📚</div>
                <h3>Structured Courses</h3>
                <p>
                    Comprehensive curriculum from beginner to advanced, designed by
                    language experts.
                </p>
            </div>

            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">🎯</div>
                <h3>Personalized Learning</h3>
                <p>
                    AI-powered recommendations and custom learning paths based on
                    your goals.
                </p>
            </div>

            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">🏆</div>
                <h3>Cultural Immersion</h3>
                <p>
                    Learn beyond language with cultural insights and real-world
                    context.
                </p>
            </div>

            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">📱</div>
                <h3>Learn Anywhere</h3>
                <p>
                    Access your lessons on any device, continue learning on the go.
                </p>
            </div>

            <div class="feature-card animate-on-scroll">
                <div class="feature-icon">🌟</div>
                <h3>Expert Teachers</h3>
                <p>
                    Learn from qualified native speakers and certified Japanese
                    instructors.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials -->
<section class="testimonials animate-on-scroll">
    <div class="container">
        <div class="section-header">
            <h2>What Our Students Say</h2>
            <p>
                Join thousands of learners who've transformed their Japanese
                skills
            </p>
        </div>

        <div class="testimonials-grid">
            <div class="testimonial-card animate-on-scroll">
                <div class="testimonial-content">
                    <p>
                        "Nihongo Sekai transformed my Japanese learning experience.
                        The live conversations with native speakers gave me confidence
                        I never had before."
                    </p>
                </div>
                <div class="testimonial-author">
                    <div class="author-avatar">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah"
                             alt="Sarah Kim" />
                    </div>
                    <div class="author-info">
                        <h4>Sarah Kim</h4>
                        <p>Software Engineer</p>
                        <div class="author-rating">⭐⭐⭐⭐⭐</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card animate-on-scroll">
                <div class="testimonial-content">
                    <p>
                        "The structured approach and cultural insights made learning
                        Japanese enjoyable and effective. I went from zero to
                        conversational in 6 months!"
                    </p>
                </div>
                <div class="testimonial-author">
                    <div class="author-avatar">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Mike"
                             alt="Mike Chen" />
                    </div>
                    <div class="author-info">
                        <h4>Mike Chen</h4>
                        <p>Business Analyst</p>
                        <div class="author-rating">⭐⭐⭐⭐⭐</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card animate-on-scroll">
                <div class="testimonial-content">
                    <p>
                        "The flexibility to learn at my own pace while having access
                        to live teachers when needed is exactly what I was looking
                        for."
                    </p>
                </div>
                <div class="testimonial-author">
                    <div class="author-avatar">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Emma"
                             alt="Emma Rodriguez" />
                    </div>
                    <div class="author-info">
                        <h4>Emma Rodriguez</h4>
                        <p>Marketing Manager</p>
                        <div class="author-rating">⭐⭐⭐⭐⭐</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action Section -->

    <section class="cta-section text-center animate-on-scroll"
    style="background: linear-gradient(135deg, #e02424, #ec4899); padding: 100px 0 80px 0; margin-bottom: 0;">
        <div class="container h-100 d-flex flex-column justify-content-center align-items-center">
            <h2 class="fw-bold mb-3 display-6" style="color: #0F172A;">
                Ready to Start Your Japanese Journey?
            </h2>
            <p class="lead mb-4 text-white">
                Join thousands of students who have successfully learned Japanese with us
            </p>
            <div class="d-flex gap-3 flex-wrap justify-content-center">
@if (!User.Identity.IsAuthenticated || !User.IsInRole("Learner"))
{
                <a href="/Account/Register" class="btn fw-semibold px-4 py-2 rounded"
                style="background-color: #fff; color: #e02424; min-width: 180px;">
                    Get Started Free
                </a>
}
                <a href="/Courses" class="btn fw-semibold px-4 py-2 rounded"
                style="color: #fff; border: 2px solid #fff; background-color: transparent; min-width: 180px;">
                    Browse Courses
                </a>
            </div>
        </div>
    </section>

@section Scripts {
    <script>
        /**
         * Home Page JavaScript
         * Handles featured content, animations, and page-specific functionality
         */
        document.addEventListener("DOMContentLoaded", function () {
            loadFeaturedCourses();
            loadPopularClassrooms();
        });
         
        class HomePage {
          constructor() {
            this.init();
          }

          init() {
            this.initializeAnimations();
            this.setupSakuraEffect();
          }

          initializeAnimations() {
            // Add intersection observer for scroll animations
            const observerOptions = {
              threshold: 0.1,
              rootMargin: "0px 0px -50px 0px",
            };

            const observer = new IntersectionObserver((entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  entry.target.style.animationPlayState = "running";
                  observer.unobserve(entry.target);
                }
              });
            }, observerOptions);

            // Observe all animated elements
            document.querySelectorAll(".animate-on-scroll").forEach((el) => {
              observer.observe(el);
            });

            // Stagger feature cards animation
            const featureCards = document.querySelectorAll(".feature-card");
            featureCards.forEach((card, index) => {
              card.style.animationDelay = `${index * 0.2}s`;
            });

            // Stagger testimonial cards animation
            const testimonialCards = document.querySelectorAll(".testimonial-card");
            testimonialCards.forEach((card, index) => {
              card.style.animationDelay = `${index * 0.3}s`;
            });
          }

          setupSakuraEffect() {
            const container = document.getElementById("sakuraContainer");
            if (!container) return;

            const createSakuraPetal = () => {
              const petal = document.createElement("div");
              petal.className = "sakura-petal";

              // Random horizontal position
              petal.style.left = Math.random() * 100 + "%";

              // Random size
              const size = Math.random() * 8 + 6;
              petal.style.width = size + "px";
              petal.style.height = size + "px";

              // Random animation duration
              const duration = Math.random() * 10 + 15;
              petal.style.animationDuration = duration + "s";

              // Random delay
              petal.style.animationDelay = Math.random() * 5 + "s";

              container.appendChild(petal);

              // Remove petal after animation
              setTimeout(
                () => {
                  if (petal.parentNode) {
                    petal.parentNode.removeChild(petal);
                  }
                },
                (duration + 5) * 1000,
              );
            };

            // Create initial petals
            for (let i = 0; i < 15; i++) {
              setTimeout(createSakuraPetal, i * 1000);
            }

            // Continuously create new petals
            setInterval(createSakuraPetal, 3000);
          }
        }

        // Initialize home page when DOM is loaded
        let homePage;

        document.addEventListener("DOMContentLoaded", () => {
          homePage = new HomePage();

          // Add smooth scrolling for internal links
          document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
            anchor.addEventListener("click", function (e) {
              e.preventDefault();
              const target = document.querySelector(this.getAttribute("href"));
              if (target) {
                target.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });
              }
            });
          });

          // Add parallax effect to hero background
          let ticking = false;

          function updateParallax() {
            const scrolled = window.pageYOffset;
            const rate = scrolled * -0.5;
            const heroBackground = document.querySelector(".hero-background");

            if (heroBackground) {
              heroBackground.style.transform = `translateY(${rate}px)`;
            }

            ticking = false;
          }

          function requestTick() {
            if (!ticking) {
              requestAnimationFrame(updateParallax);
              ticking = true;
            }
          }

          window.addEventListener("scroll", requestTick, { passive: true });
        });

        // Handle window resize for responsive adjustments
        window.addEventListener(
          "resize",
          Utils.debounce(() => {
            // Refresh animations and layouts if needed
            if (homePage) {
              homePage.addCardAnimations();
            }
          }, 250),
        );

    </script>
}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const totalPetals = 20;
        const half = totalPetals / 2;

        for (let i = 0; i < totalPetals; i++) {
            const petal = document.createElement("div");
            petal.classList.add("sakura-petal");

            if (i < half) {
                petal.style.left = (Math.random() * 50) + "vw";
            } else {
                petal.style.left = (50 + Math.random() * 50) + "vw";
            }

            const rotate = Math.random() * 360;
            petal.style.transform = `rotate(${rotate}deg)`;

            petal.style.animationDelay = (Math.random() * 5) + "s";
            petal.style.animationDuration = (5 + Math.random() * 5) + "s";

            document.body.appendChild(petal);
        }
    });
</script>
