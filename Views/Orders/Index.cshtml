@using JapaneseLearningPlatform.Models
@model List<Order>

@{
    ViewData["Title"] = "Tất cả đơn hàng";
    ViewData["HideNavbar"] = false;
    ViewData["HideFooter"] = false;
}

@section Styles {
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap"
          rel="stylesheet" />

    <style>
        body {
            font-family: 'Source Sans Pro', sans-serif;
        }

        .orders-table {
            border: none;
            overflow: hidden;
            border-radius: .75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

            .orders-table th {
                background-color: #fff;
                border-bottom: 2px solid #dee2e6;
                font-weight: 600;
                vertical-align: middle;
            }

            .orders-table tbody tr {
                transition: background 0.2s, transform 0.2s;
            }

                .orders-table tbody tr:nth-child(odd) {
                    background-color: #f9fafb;
                }

                .orders-table tbody tr:hover {
                    background-color: #eef2f7;
                    transform: translateX(5px);
                }

            .orders-table .alert-info {
                background-color: #e3f7fc;
                border-color: #beeefb;
                margin-bottom: .25rem;
                transition: background 0.2s;
            }

                .orders-table .alert-info:hover {
                    background-color: #d0f0fa;
                }

        .badge-amount {
            min-width: 2rem;
            text-align: center;
            font-size: .9rem;
        }
    </style>
}

<div class="container my-5">
    <h3 class="mb-4">Danh sách tất cả đơn hàng của bạn</h3>

    <div class="table-responsive">
        <table class="table orders-table">
            <thead>
                <tr>
                    <th scope="col">Mã đơn hàng</th>
                    <th scope="col">Số lượng &amp; Khóa học</th>
                    <th scope="col">Tổng cộng</th>
                    @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                    {
                        <th scope="col">Người dùng</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    var total = order.OrderItems.Sum(i => i.Course.FinalPrice * i.Amount);
                    <tr>
                        <td class="align-middle">@order.Id</td>
                        <td class="align-middle">
                            <ul class="list-unstyled mb-0">
                                @foreach (var item in order.OrderItems)
                                {
                                    <li>
                                        <div class="alert alert-info py-1 px-2 d-flex justify-content-between align-items-center" role="alert">
                                            <span>
                                                <span class="badge bg-success badge-amount me-2">@item.Amount</span>
                                                [@item.Price.ToString("c")] – @item.Course.Name
                                            </span>
                                            <span class="text-muted">@((item.Price * item.Amount).ToString("c"))</span>
                                        </div>
                                    </li>
                                }
                            </ul>
                        </td>
                        <td class="align-middle fw-semibold">@total.ToString("c")</td>
                        @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                        {
                            <td class="align-middle">@order.User.FullName</td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
